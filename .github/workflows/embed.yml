name: Deploy Embed Popup to S3 and Invalidate CloudFront

on:
  workflow_dispatch:
    inputs:
      commit:
        description: "Leave blank to use current HEAD, or provide an override commit SHA"
        type: string
        required: false
      environment:
        description: "Environment to deploy"
        required: true
        default: "review"
        type: choice
        options:
          - review
          - staging
          - production

jobs:
  build_embed:
    name: Build Embed
    uses: ./.github/workflows/sync_to_s3_generic_build_embed.yml
    secrets: inherit
    with:
      refspec: ${{ inputs.refspec }}
      environment: ${{ inputs.environment }}

  push_embed:
    name: Push Embed to S3
    needs: [build_embed]
    uses: ./.github/workflows/sync_to_s3_generic_push_embed.yml
    secrets: inherit
    with:
      refspec: ${{ inputs.refspec }}
      environment: ${{ inputs.environment }}
